# MiniSnap

MiniSnap æ˜¯ä¸€ä¸ªè¶…è½»é‡çº§çš„è‡ªæ‰˜ç®¡å†…å®¹å‘å¸ƒå·¥å…·ï¼Œçµæ„Ÿæ¥æºäºâ€œè´´ä¸€ä¸‹å°±èƒ½åˆ†äº«â€çš„ä½“éªŒã€‚å®ƒè®©ä½ å¯ä»¥æŠŠ Markdown æˆ–åŸå§‹ HTML æ–‡æœ¬ç¬é—´å˜æˆå¯åˆ†äº«çš„ç½‘é¡µï¼ŒåŒæ—¶å®Œå…¨æŒæ§æ•°æ®ã€‚

## åŠŸèƒ½æ¦‚è§ˆ

- âœ… è‡ªå®šä¹‰ç™»å½•é¡µï¼Œæ”¯æŒä¼šè¯ä¿æŒï¼ˆç”¨æˆ·åå›ºå®šä¸º `admin`ï¼Œå¯†ç æ¥è‡ªç¯å¢ƒå˜é‡ï¼‰
- âœ… æ”¯æŒ Markdown ä¸åŸå§‹ HTML æ¸²æŸ“
- âœ… å†…å®¹å‚¨å­˜ä¸ºçº¯æ–‡ä»¶ï¼ˆ`content/<slug>.json`ï¼‰ï¼Œæ— éœ€æ•°æ®åº“
- âœ… è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€ slugï¼Œå¹¶æä¾›æŸ¥çœ‹ã€ç¼–è¾‘é“¾æ¥
- âœ… å¯ç¼–è¾‘å†å²å†…å®¹ï¼ˆ`/{slug}/edit`ï¼‰
- âœ… åå°å†…å®¹åˆ—è¡¨ä¸æœç´¢ï¼Œå¿«é€Ÿå®šä½å†å²å†…å®¹
- âœ… å¯é€‰æè¿°å­—æ®µï¼Œä¸°å¯Œå†…å®¹åº“æ‘˜è¦
- âœ… å¯åœ¨åå°å†…å®¹åº“ä¸­åˆ é™¤æ¡ç›®
- âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹ `GET /healthz`
- âœ… Markdown å†…å®¹é¡µæ”¯æŒäº®/æš—ä¸»é¢˜ä¸´æ—¶åˆ‡æ¢
- âœ… é¡µé¢å±•ç¤ºå‘å¸ƒæ—¶é—´åŠæœ€è¿‘æ›´æ–°æ—¶é—´

## å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡ç¯å¢ƒå˜é‡

å¤åˆ¶æ ¹ç›®å½•çš„ `.env.example` åˆ° `.env` å¹¶ä¿®æ”¹å¯†ç ï¼š

```pwsh
Copy-Item .env.example .env
# ç„¶åç¼–è¾‘ .envï¼Œæ›´æ–° ADMIN_PASSWORD
```

MiniSnap åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åŠ è½½åŒç›®å½•ä¸‹çš„ `.env`ã€‚è‹¥ `.env` ä¸å­˜åœ¨ï¼Œåˆ™å›é€€åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚

### 2. æœ¬åœ°è¿è¡Œ

```pwsh
go run ./cmd/server
```

> è‹¥éœ€ä¸´æ—¶è¦†ç›– `.env` ä¸­çš„é…ç½®ï¼Œå¯é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æˆ–ç¯å¢ƒå˜é‡å®ç°ï¼Œä¾‹å¦‚ `$env:ADMIN_PASSWORD = "devpass"`ã€‚

æœåŠ¡é»˜è®¤ç›‘å¬ `:8080`ã€‚é¦–æ¬¡è®¿é—® `http://localhost:8080/login` è¾“å…¥ç”¨æˆ·å `admin` æ­é…ç¯å¢ƒå˜é‡æŒ‡å®šçš„å¯†ç å³å¯è¿›å…¥åå°ï¼›ä¼šè¯é‡‡ç”¨å®‰å…¨ Cookie ç»´æŒï¼Œå¯åœ¨å³ä¸Šè§’éšæ—¶ç™»å‡ºã€‚

### 3. Docker è¿è¡Œ

æ— éœ€æœ¬åœ°æ„å»ºï¼Œå¯ç›´æ¥ä½¿ç”¨å‘å¸ƒåœ¨ Docker Hub çš„é•œåƒï¼š

```pwsh
docker pull evarle/minisnap:latest
docker run --rm -p 8080:8080 --env-file .env evarle/minisnap:latest
```

åå°ä¸å†…å®¹ç›®å½•ä¼šåœ¨å®¹å™¨å†… `/app/content`ã€‚è‹¥å¸Œæœ›æŒä¹…åŒ–ï¼Œè¯·æŒ‚è½½å·ï¼š

```pwsh
docker run --rm -p 8080:8080 --env-file .env -v ${PWD}/content:/app/content evarle/minisnap:latest
```

è‹¥ç¡®å®éœ€è¦è‡ªå®šä¹‰é•œåƒï¼Œå¯ä½¿ç”¨ `docker build -t yourname/minisnap:tag .` æœ¬åœ°æ„å»ºã€‚

> é•œåƒå†…ç½®çš„é»˜è®¤å¯†ç ä¸º `devpass`ï¼Œå¼ºçƒˆå»ºè®®é€šè¿‡ `.env` æˆ– `-e ADMIN_PASSWORD=...` è¦†ç›–ã€‚



## é…ç½®é¡¹

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
| --- | --- | --- |
| `ADMIN_PASSWORD` | `devpass` (Docker) / _(å¿…å¡«)_ (æœ¬åœ°) | åå°ç™»å½•å¯†ç  |
| `BIND_ADDR` | `:8080` | HTTP ç›‘å¬åœ°å€ |
| `CONTENT_DIR` | `content` | å†…å®¹å­˜å‚¨ç›®å½• |

## ç›®å½•ç»“æ„

```
cmd/server       # å¯æ‰§è¡Œå…¥å£
internal/config  # é…ç½®åŠ è½½
internal/content # å†…å®¹å­˜å‚¨ä¸æ¸²æŸ“
internal/server  # HTTP server ä¸è·¯ç”±
templates        # HTML æ¨¡æ¿
content          # å·²å‘å¸ƒå†…å®¹ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
```

## å¼€å‘è¯´æ˜

- **è¿è¡Œç¯å¢ƒ**ï¼šGo 1.22+
- **æ¨¡æ¿ç³»ç»Ÿ**ï¼šHTML æ¨¡æ¿ä½äº `templates/*.tmpl`
- **Markdown å¼•æ“**ï¼šä½¿ç”¨ `github.com/yuin/goldmark` æä¾› GitHub é£æ ¼æ¸²æŸ“
- **å­˜å‚¨æ–¹å¼**ï¼šæ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸ªæ¡ç›®å¯¹åº”ä¸€ä¸ª JSON æ–‡ä»¶
- **ä¼šè¯ç®¡ç†**ï¼šåŸºäºå®‰å…¨ HTTP Cookieï¼Œæ”¯æŒç™»å½•çŠ¶æ€ä¿æŒ
- **æ„å»ºä¼˜åŒ–**ï¼šDocker å¤šé˜¶æ®µæ„å»ºï¼Œæœ€ç»ˆé•œåƒçº¦ 20MB

### å¸¸ç”¨å‘½ä»¤

ä»“åº“å†…æä¾› `Makefile`ï¼Œå¯å¿«é€Ÿæ‰§è¡Œå¸¸è§æ“ä½œï¼š

```pwsh
make build          # ç¼–è¯‘ç”Ÿæˆ bin/minisnap
make test           # è¿è¡Œ go test ./...
make lint           # æ£€æŸ¥ gofmt + go vet
make docker-build   # æ„å»ºæœ¬åœ° Docker é•œåƒï¼ˆé»˜è®¤æ ‡ç­¾ evarle/minisnap:latestï¼‰
make docker-push    # æ¨é€é•œåƒè‡³ Docker Hubï¼ˆéœ€å…ˆ docker loginï¼‰
make docker-run     # ä»¥å½“å‰ç›®å½•å†…å®¹å¯åŠ¨å®¹å™¨
```

å¯é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é»˜è®¤é•œåƒæ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š`make docker-build IMAGE=myname/minisnap TAG=v1`ã€‚

### è°ƒè¯•æŠ€å·§

- **æœ¬åœ°çƒ­é‡è½½**ï¼šé…åˆ [air](https://github.com/cosmtrek/air) ç­‰å·¥å…·å¯ä»¥ç›‘å¬æ–‡ä»¶æ”¹åŠ¨è‡ªåŠ¨é‡å¯è¿›ç¨‹ã€‚
- **æ—¥å¿—è¾“å‡º**ï¼šæœåŠ¡ä½¿ç”¨ `slog`ï¼Œä¸´æ—¶è°ƒè¯•å¯åœ¨å…³é”®è·¯å¾„ï¼ˆå¦‚ `internal/server`ï¼‰å¢åŠ  `slog.Debug` æ—¥å¿—ï¼Œè¿è¡Œæ—¶é€šè¿‡ `GODEBUG=slogtostderr=1` è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ã€‚
- **æ–­ç‚¹è°ƒè¯•**ï¼šé€šè¿‡ `dlv`ï¼ˆ[Delve](https://github.com/go-delve/delve)ï¼‰è¿è¡Œï¼š

```pwsh
dlv debug ./cmd/server -- -admin-password=devpass -content-dir=content
```

- **æŸ¥çœ‹å­˜æ¡£å†…å®¹**ï¼šæ‰€æœ‰æ¡ç›®ä»¥ JSON å­˜å‚¨ï¼Œå¯ç›´æ¥åœ¨ `content/<slug>.json` ä¸­æŸ¥çœ‹/ç¼–è¾‘åŸå§‹æ•°æ®ã€‚

### è¿è¡Œæµ‹è¯•

```pwsh
go test ./...
```

ä¸Šè¿°å‘½ä»¤ä¹Ÿå¯é€šè¿‡ `make test` å¿«é€Ÿæ‰§è¡Œã€‚

### æŒç»­é›†æˆ

ä»“åº“åŒ…å« GitHub Actions å·¥ä½œæµ `.github/workflows/ci.yml`ï¼Œåœ¨ `push` æˆ– `pull request` æ—¶è‡ªåŠ¨æ‰§è¡Œï¼š

- `gofmt` æ£€æŸ¥ï¼ˆæ ¼å¼ä¸ç¬¦ç›´æ¥å¤±è´¥ï¼‰
- `go vet` é™æ€åˆ†æ
- `go test ./...` å•å…ƒæµ‹è¯•
- `go build ./cmd/server` ç¼–è¯‘éªŒè¯
- `docker build`ï¼ˆä»…éªŒè¯ Dockerfile æ˜¯å¦å¯æ„å»ºï¼‰

å½“æ¨é€åˆ° `main` ä¸”ä»“åº“é…ç½®äº† Secrets `DOCKERHUB_USERNAME` ä¸ `DOCKERHUB_TOKEN`ï¼ˆå»ºè®®ä½¿ç”¨ Docker Hub Access Tokenï¼‰æ—¶ï¼ŒCI ä¼šé¢å¤–æ‰§è¡Œ
`docker/build-push-action`ï¼Œå°†é•œåƒå‘å¸ƒåˆ° `evarle/minisnap:latest` ä¸ `evarle/minisnap:<commit-sha>`ã€‚

> é…ç½®æ–¹å¼ï¼šè¿›å…¥ GitHub ä»“åº“ Settings â†’ Secrets and variables â†’ Actionsï¼Œåˆ†åˆ«æ–°å¢
> `DOCKERHUB_USERNAME`ï¼ˆDocker Hub ç”¨æˆ·åï¼‰ä¸ `DOCKERHUB_TOKEN`ï¼ˆDocker Hub Access Tokenï¼‰ã€‚

é»˜è®¤ä½¿ç”¨ Go 1.22ã€‚è‹¥éœ€æ‰©å±•ï¼ˆå¦‚å¤šæ¶æ„æ„å»ºã€Helm æ‰“åŒ…ç­‰ï¼‰ï¼Œå¯åœ¨ç°æœ‰å·¥ä½œæµåŸºç¡€ä¸Šæ–°å¢ä½œä¸šæˆ–æ­¥éª¤ã€‚

## ä½¿ç”¨ç¤ºä¾‹

### å‘å¸ƒ Markdown å†…å®¹
1. è®¿é—® `http://localhost:8080/login` ç™»å½•åå°
2. åœ¨æ–‡æœ¬æ¡†ä¸­è¾“å…¥ Markdown å†…å®¹
3. å¯é€‰å¡«å†™æè¿°ä¿¡æ¯ä¾¿äºåç»­æŸ¥æ‰¾
4. ç‚¹å‡»å‘å¸ƒï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”ŸæˆçŸ­é“¾æ¥

### ç®¡ç†å·²å‘å¸ƒå†…å®¹
- è®¿é—® `/admin/library` æŸ¥çœ‹æ‰€æœ‰å·²å‘å¸ƒå†…å®¹
- ä½¿ç”¨æœç´¢åŠŸèƒ½å¿«é€Ÿå®šä½ç‰¹å®šå†…å®¹
- ç‚¹å‡» "åˆ†äº«" å¤åˆ¶é“¾æ¥ï¼Œç‚¹å‡» "åˆ é™¤" ç§»é™¤å†…å®¹
- ç‚¹å‡»æ ‡é¢˜è¿›å…¥ç¼–è¾‘é¡µé¢ä¿®æ”¹å†…å®¹

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```pwsh
# 1. è·å–å®˜æ–¹é•œåƒ
docker pull evarle/minisnap:latest

# 2. åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p ./data/content

# 3. è¿è¡Œå®¹å™¨ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰
docker run -d --name minisnap \
  -p 8080:8080 \
  -e ADMIN_PASSWORD=your-secure-password \
  -v ./data/content:/app/content \
  --restart unless-stopped \
  evarle/minisnap:latest
```

## åç»­æ‹“å±•æƒ³æ³•

- ç§é’¥/Token çº§åˆ«ç¼–è¾‘é“¾æ¥
- å†…å®¹ç‰ˆæœ¬å†å²
- API æ”¯æŒä¸ CLI å®¢æˆ·ç«¯
- æ‰¹é‡å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
- è‡ªå®šä¹‰ä¸»é¢˜æ”¯æŒ

æ¬¢è¿æ ¹æ®éœ€æ±‚è‡ªè¡Œæ‰©å±•ã€‚ç¥ç©å¾—å¼€å¿ƒ ğŸ‰
